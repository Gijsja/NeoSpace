<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LocalBBS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/ui/css/styles.css" />
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <!-- Toast container for notifications -->
    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="header-left">
          <h1>LocalBBS</h1>
          <span class="unread-badge" id="unread-badge" hidden>0</span>
        </div>
        <div class="header-right">
          <!-- Search -->
          <div class="search-container">
            <input
              type="search"
              id="search-input"
              placeholder="Search messages..."
              aria-label="Search messages"
            />
            <button type="button" class="search-clear" id="search-clear" hidden aria-label="Clear search">×</button>
          </div>
          <div class="username-container">
            <label for="username" class="sr-only">Username</label>
            <input
              type="text"
              id="username"
              placeholder="Your name"
              maxlength="20"
              aria-label="Username"
            />
            <div class="connection-status" aria-live="polite">
              <span class="status-dot" id="status-dot"></span>
              <span id="status-text">Connecting...</span>
            </div>
          </div>
        </div>
      </header>

      <!-- Messages area -->
      <main
        class="app-main"
        id="messages-scroll"
        role="log"
        aria-label="Chat messages"
      >
        <div class="messages-container" id="messages"></div>
      </main>

      <!-- Input area -->
      <footer class="app-footer">
        <form class="input-container" id="message-form">
          <label for="input" class="sr-only">Message</label>
          <input
            type="text"
            id="input"
            placeholder="Type a message…"
            autocomplete="off"
            aria-label="Message input"
          />
          <button type="submit" class="btn-send" id="send-btn">Send</button>
        </form>
      </footer>
    </div>

    <!-- Message template (for safe DOM creation) -->
    <template id="message-template">
      <article class="message" data-id="">
        <div class="message-avatar"></div>
        <div class="message-body">
          <div class="message-header">
            <span class="message-user"></span>
            <span class="message-time"></span>
            <span class="message-edited" hidden>(edited)</span>
          </div>
          <div class="message-content"></div>
          <!-- Inline editor (hidden by default) -->
          <div class="inline-editor">
            <input type="text" class="edit-input" placeholder="Edit message..." />
            <div class="inline-editor-actions">
              <button type="button" class="btn-save">Save</button>
              <button type="button" class="btn-cancel">Cancel</button>
            </div>
          </div>
        </div>
        <div class="message-actions">
          <button type="button" class="btn-edit" aria-label="Edit message">
            Edit
          </button>
          <button
            type="button"
            class="btn-delete danger"
            aria-label="Delete message"
          >
            Delete
          </button>
        </div>
      </article>
    </template>

    <!-- Confirmation modal -->
    <div class="modal-overlay hidden" id="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal">
        <h2 class="modal-title" id="modal-title">Delete Message</h2>
        <p class="modal-body">Are you sure you want to delete this message? This cannot be undone.</p>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="modal-cancel">Cancel</button>
          <button type="button" class="btn btn-danger" id="modal-confirm">Delete</button>
        </div>
      </div>
    </div>

    <!-- Scroll to bottom button -->
    <button type="button" class="scroll-bottom-btn" id="scroll-bottom" aria-label="Scroll to bottom">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>

    <script src="/ui/js/socket_glue.js"></script>
  </body>
</html>
