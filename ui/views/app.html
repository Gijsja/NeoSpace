<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LocalBBS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/ui/css/styles.css" />
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'bbs-bg': '#0f172a',
              'bbs-surface': '#1e293b',
              'bbs-border': '#475569',
              'bbs-accent': '#3b82f6',
            },
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
              mono: ['JetBrains Mono', 'Fira Code', 'monospace'],
            }
          }
        }
      }
    </script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body class="bg-bbs-bg text-slate-200">
    <!-- Toast container -->
    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <!-- Three-pane dashboard -->
    <div class="flex h-screen">
      
      <!-- LEFT SIDEBAR: Rooms & Navigation -->
      <aside id="sidebar" class="w-56 bg-bbs-surface border-r border-bbs-border flex flex-col shrink-0">
        <div class="p-4 border-b border-bbs-border">
          <h1 class="text-lg font-semibold text-bbs-accent">LocalBBS</h1>
        </div>
        <nav class="flex-1 overflow-y-auto p-2">
          <div class="mb-4">
            <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wide px-2 mb-2">Channels</h2>
            <ul class="space-y-1">
              <li><a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded bg-bbs-accent/20 text-bbs-accent text-sm"># general</a></li>
              <li><a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-slate-700 text-slate-400 text-sm"># random</a></li>
              <li><a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-slate-700 text-slate-400 text-sm"># generative-art</a></li>
            </ul>
          </div>
          <div>
            <h2 class="text-xs font-semibold text-slate-500 uppercase tracking-wide px-2 mb-2">Direct Messages</h2>
            <ul class="space-y-1">
              <li><a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-slate-700 text-slate-400 text-sm">
                <span class="w-2 h-2 rounded-full bg-green-500"></span> Alex
              </a></li>
            </ul>
          </div>
        </nav>
        <div class="p-2 border-t border-bbs-border">
          <button class="w-full px-3 py-2 text-sm bg-bbs-accent hover:bg-blue-600 rounded text-white font-medium transition">+ Create Room</button>
        </div>
      </aside>

      <!-- CENTER: Main Content Area -->
      <main class="flex-1 flex flex-col min-w-0">
        <!-- Header -->
        <header class="flex items-center justify-between px-4 py-3 bg-bbs-surface border-b border-bbs-border shrink-0">
          <div class="flex items-center gap-3">
            <span class="text-slate-300 font-medium"># general</span>
            <span class="unread-badge hidden" id="unread-badge">0</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="relative">
              <input type="search" id="search-input" placeholder="Search..." class="w-40 px-3 py-1.5 text-sm bg-bbs-bg border border-bbs-border rounded focus:outline-none focus:border-bbs-accent placeholder-slate-500" />
              <button type="button" class="search-clear absolute right-1 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-300 hidden" id="search-clear">√ó</button>
            </div>
            <div class="flex items-center gap-1.5 text-sm text-slate-400">
              <span class="w-2 h-2 rounded-full bg-slate-500" id="status-dot"></span>
              <span id="status-text">Connecting...</span>
            </div>
            <input type="text" id="username" placeholder="Your name" maxlength="20" class="w-24 px-2 py-1 text-sm bg-bbs-bg border border-bbs-border rounded focus:outline-none focus:border-bbs-accent placeholder-slate-500" />
          </div>
        </header>

        <!-- Messages area -->
        <div class="flex-1 overflow-y-auto p-4" id="messages-scroll" role="log" aria-label="Chat messages">
          <div class="messages-container space-y-2" id="messages"></div>
        </div>

        <!-- Input area -->
        <footer class="p-4 bg-bbs-surface border-t border-bbs-border shrink-0">
          <form class="flex gap-2" id="message-form">
            <input type="text" id="input" placeholder="Type a message‚Ä¶" autocomplete="off" class="flex-1 px-4 py-2 bg-bbs-bg border border-bbs-border rounded focus:outline-none focus:border-bbs-accent placeholder-slate-500" />
            <button type="submit" class="px-6 py-2 bg-bbs-accent hover:bg-blue-600 rounded text-white font-medium transition" id="send-btn">Send</button>
          </form>
        </footer>
      </main>

      <!-- RIGHT SIDEBAR: Context Panel -->
      <aside id="context-panel" class="w-72 bg-bbs-surface border-l border-bbs-border flex flex-col shrink-0">
        <div class="p-4 border-b border-bbs-border">
          <h2 class="text-sm font-semibold text-slate-300">Your Profile</h2>
        </div>
        <div class="p-4 flex flex-col items-center">
          <!-- Mini Profile Card -->
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-2xl font-bold mb-3">U</div>
          <div class="text-center mb-4">
            <h3 class="font-semibold" id="profile-name">Username</h3>
            <p class="text-sm text-slate-400">Local Creator</p>
          </div>
          <!-- Mode Toggles -->
          <div class="w-full space-y-2">
            <button id="btn-code-mode" class="w-full px-3 py-2 text-sm bg-emerald-600/20 hover:bg-emerald-600/30 border border-emerald-600/50 rounded text-emerald-400 font-medium transition flex items-center justify-center gap-2">
              <span>‚ö°</span> Code Mode
            </button>
            <button id="btn-wall" class="w-full px-3 py-2 text-sm bg-purple-600/20 hover:bg-purple-600/30 border border-purple-600/50 rounded text-purple-400 font-medium transition flex items-center justify-center gap-2">
              <span>üè†</span> My Wall
            </button>
            <button id="btn-internals" class="w-full px-3 py-2 text-sm bg-amber-600/20 hover:bg-amber-600/30 border border-amber-600/50 rounded text-amber-400 font-medium transition flex items-center justify-center gap-2">
              <span>üîß</span> System Internals
            </button>
          </div>
        </div>
        <!-- Quick Stats -->
        <div class="mt-auto p-4 border-t border-bbs-border">
          <div class="text-xs text-slate-500">
            <div class="flex justify-between mb-1"><span>Messages</span><span class="text-slate-400">42</span></div>
            <div class="flex justify-between"><span>Online</span><span class="text-green-400">‚óè 3 users</span></div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Message template (for safe DOM creation) -->
    <template id="message-template">
      <article class="message bg-bbs-surface hover:bg-slate-700/50 rounded-lg p-3 flex gap-3 transition" data-id="">
        <div class="message-avatar w-9 h-9 rounded-full flex items-center justify-center font-semibold text-sm text-white shrink-0"></div>
        <div class="message-body flex-1 min-w-0">
          <div class="message-header flex items-baseline gap-2 mb-1">
            <span class="message-user font-semibold text-slate-200"></span>
            <span class="message-time text-xs text-slate-500"></span>
            <span class="message-edited text-xs text-slate-500 italic hidden">(edited)</span>
          </div>
          <div class="message-content text-slate-300"></div>
          <div class="inline-editor hidden mt-2">
            <input type="text" class="edit-input w-full px-3 py-1.5 bg-bbs-bg border border-bbs-accent rounded text-sm focus:outline-none" placeholder="Edit message..." />
            <div class="inline-editor-actions flex gap-2 mt-2">
              <button type="button" class="btn-save px-3 py-1 text-sm bg-green-600 hover:bg-green-700 rounded text-white transition">Save</button>
              <button type="button" class="btn-cancel px-3 py-1 text-sm bg-slate-600 hover:bg-slate-500 rounded text-slate-200 transition">Cancel</button>
            </div>
          </div>
        </div>
        <div class="message-actions hidden gap-1 shrink-0">
          <button type="button" class="btn-edit px-2 py-1 text-xs bg-slate-700 hover:bg-slate-600 rounded text-slate-300 transition">Edit</button>
          <button type="button" class="btn-delete px-2 py-1 text-xs bg-red-600/20 hover:bg-red-600 border border-red-600/50 rounded text-red-400 hover:text-white transition">Delete</button>
        </div>
      </article>
    </template>

    <!-- Confirmation modal -->
    <div class="modal-overlay hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50" id="confirm-modal" role="dialog" aria-modal="true">
      <div class="modal bg-bbs-surface rounded-lg p-6 w-80 shadow-xl">
        <h2 class="text-lg font-semibold mb-3" id="modal-title">Delete Message</h2>
        <p class="text-slate-400 mb-6">Are you sure you want to delete this message? This cannot be undone.</p>
        <div class="flex gap-2 justify-end">
          <button type="button" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded text-slate-200 transition" id="modal-cancel">Cancel</button>
          <button type="button" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white transition" id="modal-confirm">Delete</button>
        </div>
      </div>
    </div>

    <!-- Scroll to bottom button -->
    <button type="button" class="scroll-bottom-btn fixed bottom-24 right-80 w-10 h-10 rounded-full bg-bbs-accent hover:bg-blue-600 text-white flex items-center justify-center shadow-lg opacity-0 pointer-events-none transition z-40" id="scroll-bottom">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </button>

    <!-- Navigation Script -->
    <script>
      // Mode Toggle Navigation
      document.getElementById('btn-code-mode').addEventListener('click', () => {
        window.location.href = '/ui/views/code_editor.html';
      });
      document.getElementById('btn-wall').addEventListener('click', () => {
        window.location.href = '/ui/views/wall.html';
      });
      document.getElementById('btn-internals').addEventListener('click', () => {
        window.location.href = '/ui/views/internals.html';
      });
      
      // Sync username to profile card
      const usernameInput = document.getElementById('username');
      const profileName = document.getElementById('profile-name');
      usernameInput.addEventListener('input', () => {
        profileName.textContent = usernameInput.value || 'Username';
      });
    </script>

    <script src="/ui/js/socket_glue.js"></script>
  </body>
</html>
