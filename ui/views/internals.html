<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Feline Operations Center - NeoSpace</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'cat-black': '#050505',
            'cat-neon': '#ccff00',  /* Acid Lime */
            'cat-pink': '#ff00ff',  /* Hot Pink */
            'cat-dim': '#333333',
          },
          fontFamily: {
            mono: ['JetBrains Mono', 'Fira Code', 'monospace'],
          },
          animation: {
            'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    /* CRT scanline effect */
    .scanlines::after {
      content: "";
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(0deg,
          rgba(0, 0, 0, 0.1) 0px,
          rgba(0, 0, 0, 0.1) 1px,
          rgba(204, 255, 0, 0.05) 1px,
          transparent 2px);
      pointer-events: none;
    }

    .glitch-text:hover {
      animation: glitch 1s infinite;
      color: #ff00ff;
    }

    @keyframes glitch {
      0% {
        transform: translate(0)
      }

      20% {
        transform: translate(-2px, 2px)
      }

      40% {
        transform: translate(-2px, -2px)
      }

      60% {
        transform: translate(2px, 2px)
      }

      80% {
        transform: translate(2px, -2px)
      }

      100% {
        transform: translate(0)
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 12px;
      background: #111;
      border-left: 2px solid #ccff00;
    }

    ::-webkit-scrollbar-thumb {
      background: #ccff00;
      border: 2px solid #000;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #ff00ff;
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const socket = io();
      const logContainer = document.getElementById('log-container');
      const driftEl = document.getElementById('drift-value');
      const syncDot = document.getElementById('sync-dot');
      const syncText = document.getElementById('sync-text');

      // --- LOG LOGIC ---
      function appendLog(direction, type, data) {
        const row = document.createElement('div');
        const ts = new Date().toISOString().split('T')[1].slice(0, -1); // HH:MM:SS.mmm

        let color = 'text-gray-500';
        let icon = '‚Ä¢';
        if (direction === 'IN') { color = 'text-cat-neon'; icon = '‚óÑ'; }
        if (direction === 'OUT') { color = 'text-cat-pink'; icon = '‚ñ∫'; }

        // Format data object
        let dataStr = JSON.stringify(data);
        if (dataStr.length > 50) dataStr = dataStr.substring(0, 50) + '...';

        row.className = "font-mono border-b border-cat-dim/30 py-1 hover:bg-cat-dim/20 transition-colors";
        row.innerHTML = `
                <span class="text-cat-dim text-[10px] mr-2">${ts}</span> 
                <span class="${color} font-bold mr-1">${icon}</span> 
                <span class="text-white font-bold mr-2 uppercase">${type}</span> 
                <span class="text-gray-400 text-xs">${dataStr}</span>
            `;

        logContainer.appendChild(row);
        logContainer.scrollTop = logContainer.scrollHeight;

        // Prune old logs
        if (logContainer.children.length > 100) {
          logContainer.removeChild(logContainer.firstChild);
        }
      }

      // --- SOCKET HOOKS ---
      const EVENTS = ['connect', 'disconnect', 'message', 'typing', 'stop_typing', 'backfill'];

      EVENTS.forEach(evt => {
        socket.on(evt, (data) => {
          appendLog('IN', evt, data || {});
        });
      });

      // Capture outgoing (monkey patch emit)
      const originalEmit = socket.emit;
      socket.emit = function (event, ...args) {
        if (event !== 'latency_check') { // ignore internal noise
          appendLog('OUT', event, args[0] || {});
        }
        return originalEmit.apply(this, arguments);
      };

      // --- CONNECTION STATUS ---
      socket.on('connect', () => {
        syncDot.className = "w-4 h-4 rounded-none bg-cat-neon animate-pulse border border-black";
        syncText.textContent = "PURRING";
        syncText.className = "text-cat-neon font-black text-xl tracking-tighter loading-text";
      });

      socket.on('disconnect', () => {
        syncDot.className = "w-4 h-4 rounded-none bg-cat-pink animate-pulse border border-black";
        syncText.textContent = "HISSING";
        syncText.className = "text-cat-pink font-black text-xl tracking-tighter glitch-text";
      });

      // --- DRIFT / LATENCY CHECK ---
      setInterval(() => {
        if (socket.connected) {
          const start = Date.now();
          socket.volatile.emit('latency_check', { ts: start }, () => {
            const rtt = Date.now() - start;
            driftEl.textContent = `${rtt}ms`;
            if (rtt > 100) driftEl.className = "text-cat-pink font-bold";
            else driftEl.className = "text-cat-neon font-bold";
          });
        }
      }, 5000);

      // Manual triggers
      document.getElementById('btn-reconnect').addEventListener('click', () => {
        socket.disconnect();
        setTimeout(() => socket.connect(), 500);
      });

      // Copy Diagnostics
      document.getElementById('btn-copy').addEventListener('click', async () => {
        const diagnostics = {
          timestamp: new Date().toISOString(),
          connected: socket.connected,
          transport: socket.io?.engine?.transport?.name || 'unknown',
          logs: Array.from(logContainer.children).map(el => el.textContent.trim()),
          userAgent: navigator.userAgent
        };

        try {
          await navigator.clipboard.writeText(JSON.stringify(diagnostics, null, 2));
          const btn = document.getElementById('btn-copy');
          const originalText = btn.innerHTML;
          btn.innerHTML = '<span class="text-cat-neon">‚úì COPIED!</span>';
          setTimeout(() => btn.innerHTML = originalText, 2000);
        } catch (e) {
          alert('Failed to copy');
        }
      });

      // Fake Vitals Animation
      setInterval(() => {
        const bars = document.querySelectorAll('.zoomie-bar');
        bars.forEach(bar => {
          const h = Math.random() * 100;
          bar.style.height = `${h}%`;
        });
      }, 200);
    });
  </script>
</head>

<body
  class="bg-cat-black text-white font-mono h-screen flex flex-col overflow-hidden selection:bg-cat-pink selection:text-white">

  <!-- Top Bar -->
  <header
    class="h-12 border-b-2 border-cat-neon flex items-center justify-between px-4 bg-cat-black shrink-0 z-10 relative">
    <div class="flex items-center gap-4">
      <a href="/ui/views/app.html"
        class="text-cat-pink hover:text-white font-bold uppercase tracking-widest text-xs border border-transparent hover:border-cat-pink px-2 py-1 transition-all">
        ‚Üê EJECT
      </a>
      <div class="h-6 w-0.5 bg-cat-dim"></div>
      <h1 class="font-black italic text-xl tracking-tighter uppercase text-cat-neon">
        <span class="text-white">FELINE</span>OPS<span class="text-cat-pink">.CTR</span>
      </h1>
    </div>
    <div class="font-bold text-xs tracking-widest">
      KERNEL v9.0 // LIVES: <span class="text-cat-neon">9/9</span>
    </div>
  </header>

  <!-- Main Grid -->
  <div class="flex-1 flex overflow-hidden">

    <!-- LEFT: The Meow Monitor (Logs) -->
    <div class="flex-1 flex flex-col border-r-2 border-cat-dim relative">
      <div
        class="bg-cat-neon text-black text-xs font-black px-2 py-1 uppercase tracking-widest flex justify-between items-center">
        <span>// MEOW_MONITOR_v1 (Socket I/O)</span>
        <span class="animate-pulse">‚óè REC</span>
      </div>

      <!-- CRT Screen -->
      <div
        class="flex-1 bg-[#080808] relative overflow-hidden flex flex-col p-4 scanlines shadow-[inset_0_0_50px_rgba(0,0,0,0.8)]">
        <div id="log-container" class="flex-1 overflow-y-auto space-y-1 font-mono text-sm pb-10">
          <div class="text-cat-dim italic text-xs mb-4">
            > Initializing Feline Neural Network...<br>
            > Loading whiskers.sys... OK<br>
            > Calibrating purr engine... OK<br>
            > Listening for treats...
          </div>
        </div>

        <!-- Decor Text -->
        <div class="absolute bottom-2 right-2 text-[10px] text-cat-dim font-bold opacity-50 pointer-events-none">
          BUFFER_SIZE: 100 // AUTO_PRUNE: ON
        </div>
      </div>
    </div>

    <!-- RIGHT: Vitals & Control -->
    <div class="w-96 bg-cat-black flex flex-col border-l-2 border-cat-dim">

      <!-- CAT ASCII -->
      <div class="p-4 border-b-2 border-cat-dim flex justify-center bg-[#111]">
        <pre class="text-[10px] leading-tight text-cat-pink font-bold select-none">
      |\      _,,,---,,_
ZZZzz /,`.-'`'    -.  ;-;;,_
     |,4-  ) )-,_. ,\ (  `'-'
    '---''(_/--'  `-'\_)  
  [ SYSTEM ASLEEP? NO. WATCHING. ]
            </pre>
      </div>

      <!-- VITALS 1: PURR FREQUENCY (Connection) -->
      <div class="p-4 border-b-2 border-cat-dim">
        <h3 class="text-cat-neon text-xs font-black uppercase mb-4 tracking-widest border-b border-cat-dim pb-1">
          Purr Frequency (SYNC)
        </h3>
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-3">
            <div id="sync-dot" class="w-4 h-4 bg-cat-dim border border-black"></div>
            <span id="sync-text" class="text-cat-dim font-bold text-xl tracking-tighter">WAITING</span>
          </div>
        </div>
        <div class="flex justify-between text-xs font-mono text-gray-500">
          <span>Whisker Twitch (Latency):</span>
          <span id="drift-value" class="text-white">--</span>
        </div>
      </div>

      <!-- VITALS 2: BRAIN ZOOMIES (Fake CPU) -->
      <div class="p-4 border-b-2 border-cat-dim flex-1">
        <h3 class="text-cat-neon text-xs font-black uppercase mb-4 tracking-widest border-b border-cat-dim pb-1">
          Brain Zoomies (Load)
        </h3>
        <div class="flex gap-1 h-24 items-end mb-4 border-b border-cat-dim pb-1">
          <!-- 10 bars -->
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 20%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 50%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 80%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 30%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 90%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 40%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 60%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 10%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 70%"></div>
          <div class="zoomie-bar w-full bg-cat-pink transition-all duration-200" style="height: 100%"></div>
        </div>
        <div class="text-xs text-cat-dim text-center uppercase tracking-widest">
          Calculating jump trajectory...
        </div>
      </div>

      <!-- CONTROLS: CATNIP -->
      <div class="p-4 bg-cat-dim/10">
        <h3 class="text-white text-xs font-black uppercase mb-3 tracking-widest">
          Catnip Injection (Tools)
        </h3>
        <div class="space-y-2">
          <button id="btn-reconnect"
            class="w-full border-2 border-cat-pink text-cat-pink hover:bg-cat-pink hover:text-black font-bold text-xs uppercase py-3 px-4 transition-all active:translate-y-1">
            ‚ñ∫ Wake Up Cat (Reconnect)
          </button>
          <button
            class="w-full border-2 border-cat-neon text-cat-neon hover:bg-cat-neon hover:text-black font-bold text-xs uppercase py-3 px-4 transition-all active:translate-y-1">
            ‚ñ∫ Cough Hairball (Backfill)
          </button>
          <button id="btn-copy"
            class="w-full border-2 border-gray-600 text-gray-400 hover:border-white hover:text-white font-bold text-xs uppercase py-2 px-4 transition-all">
            üìã Vet Report (Copy Log)
          </button>
        </div>
      </div>

    </div>
  </div>

</body>

</html>