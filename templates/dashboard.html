{% extends "base.html" %}

{% block title %}Dashboard - NeoSpace{% endblock %}
{% block page_title %}Mission Control{% endblock %}

{% block content %}
{% from "components/ui_macros.html" import button, select %}
<!-- --- PHASE 6: CONCRETE DASHBOARD --- -->
<div class="grid grid-cols-1 lg:grid-cols-12 gap-6 pb-20 pt-4">

    <!-- Row 1: KPI Stats -->

    <!-- STAT 1: ACTIVE USERS -->
    <div class="lg:col-span-3 nb-card p-5 relative overflow-hidden group hover:bg-yellow-100 transition-colors">
        <div class="flex flex-col relative z-10">
            <span
                class="text-xs font-black text-black uppercase tracking-widest mb-1 border-b-2 border-black pb-1 inline-block w-max">Active
                Personnel</span>
            <div class="flex items-baseline gap-2 mt-2">
                <span class="text-4xl font-black text-black tracking-tighter">24</span>
                <span
                    class="text-xs font-bold text-black bg-acid-green px-1 border border-black flex items-center gap-1">
                    +12%
                </span>
            </div>
        </div>
        <!-- Brutalist Sparkline -->
        <svg class="absolute bottom-2 right-2 w-24 h-12 text-black opacity-20 group-hover:opacity-100 transition-opacity"
            viewBox="0 0 100 40" preserveAspectRatio="none">
            <path vector-effect="non-scaling-stroke" d="M0,40 Q25,10 50,30 T100,5" fill="none" stroke="currentColor"
                stroke-width="4" stroke-linecap="square" />
        </svg>
    </div>

    <!-- STAT 2: MESSAGES -->
    <div class="lg:col-span-3 nb-card p-5 relative overflow-hidden group hover:bg-pink-100 transition-colors">
        <div class="flex flex-col relative z-10">
            <span
                class="text-xs font-black text-black uppercase tracking-widest mb-1 border-b-2 border-black pb-1 inline-block w-max">Comms
                Volume</span>
            <div class="flex items-baseline gap-2 mt-2">
                <span class="text-4xl font-black text-black tracking-tighter">1,247</span>
                <span
                    class="text-xs font-bold text-black bg-acid-green px-1 border border-black flex items-center gap-1">
                    +5.4%
                </span>
            </div>
        </div>
        <svg class="absolute bottom-2 right-2 w-24 h-12 text-black opacity-20 group-hover:opacity-100 transition-opacity"
            viewBox="0 0 100 40" preserveAspectRatio="none">
            <path vector-effect="non-scaling-stroke" d="M0,35 L20,25 L40,30 L60,10 L80,20 L100,5" fill="none"
                stroke="currentColor" stroke-width="4" stroke-linejoin="bevel" />
        </svg>
    </div>

    <!-- STAT 3: SCRIPTS RUN -->
    <div class="lg:col-span-3 nb-card p-5 relative overflow-hidden group hover:bg-blue-100 transition-colors">
        <div class="flex flex-col relative z-10">
            <span
                class="text-xs font-black text-black uppercase tracking-widest mb-1 border-b-2 border-black pb-1 inline-block w-max">Sandbox
                Execs</span>
            <div class="flex items-baseline gap-2 mt-2">
                <span class="text-4xl font-black text-black tracking-tighter">89</span>
                <span class="text-xs font-bold text-white bg-black px-1 border border-black flex items-center gap-1">
                    -2%
                </span>
            </div>
        </div>
        <svg class="absolute bottom-2 right-2 w-24 h-12 text-black opacity-20 group-hover:opacity-100 transition-opacity"
            viewBox="0 0 100 40" preserveAspectRatio="none">
            <path vector-effect="non-scaling-stroke" d="M0,20 Q40,40 100,10" fill="none" stroke="currentColor"
                stroke-width="4" />
        </svg>
    </div>

    <!-- STAT 4: DB SIZE -->
    <div class="lg:col-span-3 nb-card p-5 relative overflow-hidden group hover:bg-orange-100 transition-colors">
        <div class="flex flex-col relative z-10">
            <span
                class="text-xs font-black text-black uppercase tracking-widest mb-1 border-b-2 border-black pb-1 inline-block w-max">Memory
                Usage</span>
            <div class="flex items-baseline gap-2 mt-2">
                <span class="text-4xl font-black text-black tracking-tighter">48 MB</span>
                <span
                    class="text-xs font-bold text-black bg-acid-green px-1 border border-black flex items-center gap-1">
                    OK
                </span>
            </div>
        </div>
        <div
            class="absolute -right-6 -bottom-6 w-24 h-24 rounded-none border-4 border-black opacity-10 group-hover:opacity-100 transition-opacity rotate-12">
        </div>
    </div>


    <!-- Row 2: Charts & Feed -->

    <!-- CHART 1 - TRAFFIC (Area) -->
    <div class="lg:col-span-8 nb-card p-6 flex flex-col">
        <div class="flex items-center justify-between mb-4 border-b-2 border-black pb-2">
            <h3 class="text-sm font-black text-black uppercase flex items-center gap-2">
                <i class="ph-bold ph-activity"></i> Network Traffic
            </h3>
            {{ select('time_range', [
            ('24h', 'Last 24h'),
            ('7d', 'Last 7d')
            ], wrapper_class='w-auto', class='text-xs font-bold p-1 shadow-hard-sm focus:outline-none') }}
        </div>
        <div class="flex-1 w-full min-h-[300px]" x-data x-init="
                const options = {
                    series: [{
                        name: 'Inbound',
                        data: [31, 40, 28, 51, 42, 109, 100]
                    }, {
                        name: 'Outbound',
                        data: [11, 32, 45, 32, 34, 52, 41]
                    }],
                    chart: {
                        height: '100%',
                        type: 'area',
                        toolbar: { show: false },
                        background: 'transparent',
                        fontFamily: 'monospace' // Raw font
                    },
                    theme: { mode: 'light' }, // Light mode for concrete
                    colors: ['#000000', '#a3e635'], // Black & Acid Green
                    dataLabels: { enabled: false },
                    stroke: { curve: 'straight', width: 3 }, // Straight lines
                    fill: {
                        type: 'solid',
                        opacity: [0.1, 0.4]
                    },
                    xaxis: {
                        categories: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
                        axisBorder: { show: true, color: '#000' },
                        axisTicks: { show: true, color: '#000' },
                        labels: { style: { colors: '#000', fontFamily: 'monospace', fontWeight: 700 } }
                    },
                    yaxis: {
                        labels: { style: { colors: '#000', fontFamily: 'monospace', fontWeight: 700 } }
                    },
                    grid: {
                        borderColor: '#000',
                        strokeDashArray: 0, // Solid grid lines
                        position: 'back',
                        xaxis: { lines: { show: true } } 
                    },
                    legend: { 
                        show: true, 
                        position: 'top', 
                        horizontalAlign: 'right',
                        fontFamily: 'monospace',
                        fontWeight: 700,
                        labels: { colors: '#000' },
                        markers: { width: 12, height: 12, strokeWidth: 2, strokeColor: '#000', radius: 0 }
                    }
                };
                new ApexCharts($el, options).render();
             ">
        </div>
    </div>

    <!-- RIGHT COLUMN: CPU & Feed -->
    <div class="lg:col-span-4 flex flex-col gap-6">

        <!-- CHART 2 - CPU LOAD (Radial) -->
        <div class="nb-card p-6">
            <h3
                class="text-sm font-black text-black uppercase flex items-center gap-2 mb-2 border-b-2 border-black pb-2">
                <i class="ph-bold ph-cpu"></i> System Load
            </h3>
            <div class="flex items-center justify-center -mt-4" x-data x-init="
                    const options = {
                        series: [76],
                        chart: {
                            height: 280,
                            type: 'radialBar',
                            background: 'transparent',
                        },
                        plotOptions: {
                            radialBar: {
                                startAngle: -90,
                                endAngle: 90,
                                hollow: {
                                    margin: 15,
                                    size: '60%',
                                    background: 'transparent',
                                },
                                track: {
                                    background: '#fff',
                                    strokeWidth: '100%',
                                    margin: 0,
                                    dropShadow: { enabled: true, top: 4, left: 4, blur: 0, opacity: 1, color: '#000' } // Hard Shadow via Apex? Maybe tricky.
                                },
                                dataLabels: {
                                    show: true,
                                    name: {
                                        offsetY: -20,
                                        show: true,
                                        color: '#000',
                                        fontSize: '12px',
                                        fontFamily: 'monospace',
                                        fontWeight: 700
                                    },
                                    value: {
                                        offsetY: -10,
                                        color: '#000',
                                        fontSize: '32px',
                                        show: true,
                                        fontWeight: 900,
                                        fontFamily: 'monospace',
                                        formatter: function (val) {
                                            return val + '%';
                                        }
                                    }
                                }
                            }
                        },
                        fill: {
                             type: 'solid',
                             colors: ['#ff6b6b'] // Hot Pink
                        },
                        stroke: {
                            lineCap: 'butt' // Hard edges
                        },
                        labels: ['CPU Load'],
                    };
                    new ApexCharts($el, options).render();
                 ">
            </div>

            <!-- Mini Resource Bars -->
            <div class="space-y-3 mt-[-20px] font-mono">
                <div>
                    <div class="flex justify-between text-xs mb-1 font-bold">
                        <span class="text-black uppercase">Memory</span>
                        <span class="text-black">4.2 / 8 GB</span>
                    </div>
                    <div class="h-3 w-full bg-white border-2 border-black rounded-none">
                        <div class="h-full bg-electric-blue w-[55%] border-r-2 border-black"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-xs mb-1 font-bold">
                        <span class="text-black uppercase">Storage</span>
                        <span class="text-black">120 GB</span>
                    </div>
                    <div class="h-3 w-full bg-white border-2 border-black rounded-none">
                        <div class="h-full bg-purple-500 w-[30%] border-r-2 border-black"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACTIVITY FEED -->
        <div class="nb-card p-0 flex-1 flex flex-col overflow-hidden max-h-[400px]">
            <div class="p-4 border-b-2 border-black flex items-center justify-between bg-white">
                <h3 class="text-sm font-black text-black uppercase">Live Feed</h3>
                <span class="w-3 h-3 bg-acid-green border-2 border-black animate-pulse"></span>
            </div>
            <div class="flex-1 overflow-y-auto p-0 custom-scrollbar">

                <!-- Timeline container -->
                <!-- No vertical line, just border-b items -->
                <div class="flex flex-col">

                    <!-- Item 1 -->
                    <div
                        class="flex items-start gap-4 p-4 border-b-2 border-black hover:bg-yellow-50 transition-colors group">
                        <!-- Square Dot -->
                        <div class="w-3 h-3 mt-1.5 bg-black z-10 box-content group-hover:bg-hot-pink transition-colors">
                        </div>
                        <!-- Content -->
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-black text-black uppercase">Jade</span>
                                <span
                                    class="text-[10px] text-black font-mono font-bold bg-gray-200 px-1 border border-black">14:02</span>
                            </div>
                            <p class="text-xs text-black font-mono mt-1">Deployed <span
                                    class="bg-black text-white px-1">bloom.glsl</span></p>
                        </div>
                    </div>

                    <!-- Item 2 -->
                    <div
                        class="flex items-start gap-4 p-4 border-b-2 border-black hover:bg-yellow-50 transition-colors group">
                        <div
                            class="w-3 h-3 mt-1.5 bg-black z-10 box-content group-hover:bg-acid-green transition-colors">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-black text-black uppercase">System</span>
                                <span
                                    class="text-[10px] text-black font-mono font-bold bg-gray-200 px-1 border border-black">13:45</span>
                            </div>
                            <p class="text-xs text-black font-mono mt-1">Backup success. <span class="font-bold">48MB
                                    synced.</span></p>
                        </div>
                    </div>

                    <!-- Item 3 -->
                    <div
                        class="flex items-start gap-4 p-4 border-b-2 border-black hover:bg-yellow-50 transition-colors group">
                        <div
                            class="w-3 h-3 mt-1.5 bg-black z-10 box-content group-hover:bg-electric-blue transition-colors">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-black text-black uppercase">Max</span>
                                <span
                                    class="text-[10px] text-black font-mono font-bold bg-gray-200 px-1 border border-black">13:10</span>
                            </div>
                            <p class="text-xs text-black font-mono mt-1">Joined room <span class="">#general</span></p>
                        </div>
                    </div>

                    <!-- Item 4 -->
                    <div class="flex items-start gap-4 p-4 hover:bg-yellow-50 transition-colors group">
                        <div class="w-3 h-3 mt-1.5 bg-black z-10 box-content group-hover:bg-hot-pink transition-colors">
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-black text-black uppercase">Security</span>
                                <span
                                    class="text-[10px] text-black font-mono font-bold bg-rose-200 px-1 border border-black">12:30</span>
                            </div>
                            <p class="text-xs text-black font-mono mt-1">Failed login attempt (IP filtered).</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- Row 3: Quick Actions -->
    <div class="lg:col-span-12 nb-card p-6 flex items-center justify-between bg-black text-white">
        <h3 class="text-sm font-black uppercase tracking-wider text-white">Quick Actions</h3>
        <div class="flex gap-4">
            {{ button('New Project', variant='secondary', class='border-white shadow-none hover:shadow-hard
            hover:bg-acid-green hover:border-black', icon='ph-bold ph-plus') }}

            {{ button('Terminal', variant='outline', class='text-white border-white hover:bg-white hover:text-black',
            icon='ph-bold ph-terminal-window') }}

            {{ button('Scan', variant='outline', class='text-white border-white hover:bg-white hover:text-black',
            icon='ph-bold ph-shield') }}
        </div>
    </div>

</div>
{% endblock %}