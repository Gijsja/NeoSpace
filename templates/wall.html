{% extends "base.html" %}

{% block title %}My Wall - NeoSpace{% endblock %}
{% block page_title %}Identity Grid{% endblock %}

{% block head %}
<!-- Scripts needed for Wall features -->
<!-- Vendored Assets -->
<script src="/static/vendor/mobile-drag-drop.min.js"></script>
<!-- Tone.js for Audio Features -->
<script src="/static/vendor/tone.js"></script>
<script>
    if (typeof MobileDragDrop !== 'undefined') {
        MobileDragDrop.polyfill({
            dragImageTranslateOverride: MobileDragDrop.scrollBehaviourDragImageTranslateOverride
        });
        window.addEventListener('touchmove', function () { }, { passive: false });
    }
</script>
<script src="/static/vendor/marked.min.js"></script>
<script src="/static/vendor/purify.min.js"></script>
<link rel="stylesheet" href="/static/vendor/highlight-atom-one-dark.min.css">
<script src="/static/vendor/highlight.min.js"></script>

<!-- Theme Stylesheets -->
<link rel="stylesheet" href="/static/css/themes/hacker.css" id="theme-hacker-css" disabled>

<script>
    // Initialize highlight.js
    hljs.highlightAll();
</script>
{% endblock %}

{% block content %}
{% from "components/ui_macros.html" import button, input, card, badge, textarea, select %}
{% from "components/skeleton.html" import skeleton %}
{% from "components/modals/edit_profile.html" import edit_profile_modal %}
{% from "components/modals/add_module.html" import add_module_modal %}
{% from "components/wall/identity_header.html" import identity_header %}
<!-- Loading State -->
<!-- Loading State (Skeleton) -->
<div id="loading" class="animate-pulse space-y-8 pb-20 pt-4">
    <!-- Header Skeleton -->
    <div class="nb-card p-0 h-64 relative bg-gray-100 border-4 border-transparent">
        <div class="absolute bottom-6 left-8 md:left-48 space-y-2">
            {{ skeleton('h-10 w-64 bg-gray-300') }}
            {{ skeleton('h-6 w-32 bg-gray-300') }}
        </div>
        <div class="absolute -top-12 left-8 w-32 h-32 bg-gray-200 border-4 border-white"></div>
    </div>

    <!-- Grid Skeleton -->
    <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
        <div class="col-span-1 md:col-span-3 space-y-6">
            {{ skeleton('h-48 w-full') }}
            {{ skeleton('h-32 w-full') }}
        </div>
        <div class="col-span-1 md:col-span-9 space-y-6">
            {{ skeleton('h-32 w-full') }}
            {{ skeleton('h-64 w-full') }}
            {{ skeleton('h-64 w-full') }}
        </div>
    </div>
</div>

<!-- Main Wall Container -->
<div id="wall-container" class="hidden animate-fade-in space-y-8 pb-20 pt-4">

    <!-- 1. Identity Header (Neubrutalist Card) -->
    {{ identity_header() }}

    <!-- 2. Grid Layout -->
    <div class="grid grid-cols-1 md:grid-cols-12 gap-8">

        <!-- LEFT COLUMN (Sidebar info) - 3 cols -->
        <div class="col-span-1 md:col-span-3 space-y-6">

            <!-- "Now" Block (Yellow Card) -->
            <div class="nb-card p-4 bg-yellow-300 relative">
                <div class="flex items-center justify-between mb-2 border-b-2 border-black pb-2">
                    <h3 class="text-xs font-black uppercase tracking-widest flex items-center gap-2">
                        The Now
                    </h3>
                    <span id="now-activity-type-icon" class="text-black text-lg">
                        <i class="ph-fill ph-star"></i>
                    </span>
                </div>

                <p id="now-activity" class="font-mono font-bold text-lg leading-relaxed italic">
                    Loading...
                </p>

                {{ button('Update', variant='secondary', size='sm', attrs='id="edit-now-btn"', class='w-full mt-4 hidden
                hover:bg-black hover:text-white uppercase') }}
            </div>

            <!-- Top 8 Grid (Sprint 20) -->
            <div id="top8-section" class="hidden">
                <h3 class="font-black uppercase text-xs tracking-wider mb-2 flex items-center gap-2">
                    The Top 8
                    <span class="bg-black text-white text-[10px] px-1 rounded">FRIENDS</span>
                </h3>
                <div id="top8-grid" class="grid grid-cols-4 gap-2">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Info Stats -->
            <div class="nb-card p-4">
                <h3 class="text-xs font-black uppercase tracking-wide border-b-2 border-black pb-2 mb-3">
                    Metadata
                </h3>
                <div class="space-y-2 text-sm font-mono">
                    <div class="flex justify-between items-center">
                        <span>Joined</span>
                        <span id="member-since" class="font-bold">...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Status</span>
                        <span class="px-1 bg-acid-green border border-black text-xs font-bold uppercase">Verified</span>
                    </div>
                </div>
            </div>

            <!-- Top Friends (Grid) -->
            <div class="nb-card p-4">
                <h3 class="text-xs font-black uppercase tracking-wide mb-4 border-b-2 border-black pb-2">
                    Top 8
                </h3>
                <div class="grid grid-cols-4 gap-2">
                    <!-- 8 placeholders -->
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                    <div
                        class="aspect-square bg-gray-200 border-4 border-black hover:bg-hot-pink transition cursor-pointer">
                    </div>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN (Content) - 9 cols -->
        <div class="col-span-1 md:col-span-9 space-y-8">

            <!-- Sticker Board (Guestbook) -->
            <div class="nb-card min-h-[250px] relative overflow-hidden group border-4 border-dashed border-black bg-white hover:bg-gray-50 transition"
                id="sticker-canvas">
                <div
                    class="absolute top-0 left-0 bg-black text-white px-3 py-1 text-xs font-bold uppercase tracking-wide z-20">
                    <i class="ph-bold ph-sticker"></i> Sticker Board
                </div>
                <div class="absolute bottom-2 right-2 text-[10px] font-mono text-gray-400 uppercase">Drag & Drop Enabled
                </div>

                <!-- Palette -->
                <div id="sticker-palette"
                    class="hidden absolute bottom-4 left-4 right-4 bg-white border-4 border-black p-2 z-30 shadow-hard overflow-x-auto flex gap-4 scrollbar-hide">
                </div>
            </div>

            <!-- Wall Modules (Masonry) -->
            <div id="wall-modules-section" class="hidden">
                <h3 class="text-xl font-black uppercase tracking-tighter mb-4 flex items-center gap-2">
                    <span class="bg-black text-white px-2">Feed</span> Stream
                </h3>
                <!-- The Grid (Masonry handled by columns utility) -->
                <div id="wall-modules-grid" class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6">
                    <!-- Modules injected here -->
                </div>

                <!-- Pagination Load More -->
                <div id="wall-load-more-container" class="py-8 flex justify-center hidden">
                    <button id="btn-load-more"
                        class="nb-button px-6 py-3 bg-white border-4 border-black hover:bg-black hover:text-white transition shadow-hard font-bold uppercase tracking-widest flex items-center gap-2">
                        <i class="ph-bold ph-arrow-down"></i> Load More
                    </button>
                    <div id="loader-more" class="hidden animate-spin text-2xl"><i class="ph-bold ph-spinner"></i></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modals (Neubrutalist Style) -->

    <!-- Edit Profile Modal -->
    {{ edit_profile_modal() }}

    <!-- Add Module FAB (Brutalist Square) -->
    {{ button(None, icon='ph-bold ph-plus', size='fab', attrs='@click="$dispatch(\'open-add-module\')"', class='fixed
    bottom-8 right-8 z-40
    bg-electric-blue hover:bg-hot-pink hidden group !text-black !border-black') }}

    <!-- Add Module Modal -->
    {{ add_module_modal() }}

</div>
{% endblock %}

{% block scripts %}
<!-- Voice Support -->
<script src="/ui/js/voice.js"></script>
<!-- Wall Logic -->
<script src="/ui/js/friends.js"></script> <!-- Sprint 20 -->
<!-- <script src="/ui/js/wall.js"></script> -->
<script type="module" src="/ui/js/wall/WallMain.js"></script>

<script>
    // Force init
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof fetchProfile === 'function') fetchProfile();
        // Show FAB
        const fab = document.querySelector('.fixed.bottom-8.right-8'); // selector for the FAB
        if (fab) fab.classList.remove('hidden');
    });
</script>
{% endblock %}