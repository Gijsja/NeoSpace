<!DOCTYPE html>
<html lang="en" x-data="{ sidebarOpen: window.innerWidth > 768, doctorOpen: false }"
    @resize.window="sidebarOpen = window.innerWidth > 768" @keydown.window.ctrl.b.prevent="sidebarOpen = !sidebarOpen"
    @keydown.window.meta.b.prevent="sidebarOpen = !sidebarOpen"
    @keydown.window.ctrl.shift.d.prevent="doctorOpen = !doctorOpen"
    @keydown.window.meta.shift.d.prevent="doctorOpen = !doctorOpen">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}NeoSpace{% endblock %}</title>

    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <!-- Fonts: Inter -->
    <link rel="stylesheet" href="/static/css/fonts.css" />

    <!-- Tailwind CSS (Vendored) -->
    <script src="/static/vendor/tailwindcss.js"></script>
    <script src="/ui/js/tailwind_config.js"></script>

    <!-- Alpine.js -->
    <script defer src="/static/vendor/alpine.min.js"></script>

    <!-- Phosphor Icons -->
    <link rel="stylesheet" href="/static/vendor/phosphor/phosphor-regular.css">
    <link rel="stylesheet" href="/static/vendor/phosphor/phosphor-bold.css">
    <link rel="stylesheet" href="/static/vendor/phosphor/phosphor-fill.css">

    <!-- NeoSpace Utilities -->
    <link rel="stylesheet" href="/static/css/neospace.css">

    <!-- ApexCharts -->
    <script src="/static/vendor/apexcharts.min.js"></script>
    <!-- HTMX -->
    <script src="/static/vendor/htmx.min.js"></script>
    <!-- Socket.io -->
    <script src="/static/vendor/socket.io.min.js"></script>

    <style>
        /* --- PROJECT CONCRETE: NEUBRUTALISM --- */
        /* Custom Brutalist Scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
            background: #f0f0f0;
            border-left: 2px solid black;
        }

        ::-webkit-scrollbar-track {
            background: #fff;
            border-left: 2px solid black;
        }

        ::-webkit-scrollbar-thumb {
            background: #000;
            border: 2px solid black;
            /* Creates a padding effect if background is white, but here we want blocky */
            box-shadow: inset 2px 2px 0px 0px #fff;
            /* Inner highlight */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #FF00FF;
            /* Hot Pink on hover */
        }

        ::-webkit-scrollbar-corner {
            background: #000;
        }

        /* Selection */
        ::selection {
            background: #a3e635;
            /* Acid Green */
            color: black;
        }

        body {
            background-color: #FFFAF0;
            /* bbs-bg */
            color: #000000;
            overflow: hidden;
        }

        /* Utilities Moved to neospace.css */


        /* Custom Brutalist Scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
            background: #fff;
            border-left: 2px solid black;
        }

        ::-webkit-scrollbar-track {
            background: #fff;
            border-left: 2px solid black;
        }

        ::-webkit-scrollbar-thumb {
            background: #000;
            border: 2px solid black;
            box-shadow: inset 2px 2px 0px 0px #fff;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #FF00FF;
        }

        ::-webkit-scrollbar-corner {
            background: #000;
        }

        /* Selection */
        ::selection {
            background: #a3e635;
            color: black;
        }

        /* Animation: Equalizer */
        @keyframes equalize {
            0% {
                height: 30%;
            }

            50% {
                height: 100%;
            }

            100% {
                height: 30%;
            }
        }

        /* Sidebar Hover Slide */
        .sidebar-link:hover {
            padding-left: 1.5rem;
        }

        /* --- SPRINT 21: VISUAL POLISH ANIMATIONS --- */

        /* 1. Glitch Effect on Hover */
        .animate-glitch:hover {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            color: #FF00FF;
            /* Hot Pink */
        }

        @keyframes glitch {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-2px, 2px);
            }

            40% {
                transform: translate(-2px, -2px);
            }

            60% {
                transform: translate(2px, 2px);
            }

            80% {
                transform: translate(2px, -2px);
            }

            100% {
                transform: translate(0);
            }
        }

        /* 2. Button Spring Physics */
        .btn-spring {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-spring:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 6px 6px 0px 0px #000000;
        }

        .btn-spring:active {
            transform: translateY(2px) scale(0.98);
            box-shadow: 1px 1px 0px 0px #000000;
        }

        /* 3. Page Transitions (Fade) */
        .page-transition-enter {
            opacity: 0;
            transform: translateY(10px);
        }

        .page-transition-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }

        .page-transition-exit {
            opacity: 1;
        }

        .page-transition-exit-active {
            opacity: 0;
            transition: opacity 300ms;
        }

        /* Apply to main content */
        #app-main>div {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    {% block head %}{% endblock %}
</head>

<body class="flex flex-col h-screen overflow-hidden selection:bg-hot-pink selection:text-white font-sans bg-bbs-bg"
    hx-boost="true" hx-target="#app-main" hx-select="#app-main" hx-swap="outerHTML">

    <!-- Marquee Header -->
    <div class="h-8 bg-yellow-400 border-b-2 border-black overflow-hidden flex items-center shrink-0 relative z-50">
        <div
            class="animate-marquee whitespace-nowrap font-mono font-bold text-xs uppercase tracking-widest px-4 border-r-2 border-black">
            *** WELCOME TO NEOSPACE *** 24 USERS ONLINE *** DON'T BE EVIL *** NEOSPACE v{{ version }} *** SYSTEM
            NOMINAL
            ***
        </div>
        <div
            class="animate-marquee whitespace-nowrap font-mono font-bold text-xs uppercase tracking-widest px-4 border-r-2 border-black absolute top-0 left-full">
            *** WELCOME TO NEOSPACE *** 24 USERS ONLINE *** DON'T BE EVIL *** NEOSPACE v{{ version }} *** SYSTEM
            NOMINAL
            ***
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-1 h-full overflow-hidden relative" x-data="{ mobileNav: false }">

        <!-- Mobile Overlay -->
        <div x-show="sidebarOpen" class="fixed inset-0 bg-black/50 z-30 md:hidden" @click="sidebarOpen = false"
            x-transition.opacity></div>

        <!-- Sidebar ("Index Card Stack") -->
        {% from 'components/sidebar.html' import sidebar_nav %}
        {{ sidebar_nav() }}

        <!-- Main Content Wrapper -->
        <main id="app-main" class="flex-1 flex flex-col min-w-0 h-full relative z-20">

            <!-- Header (Brutalist Top Bar) -->
            <header class="h-16 flex items-center justify-between px-6 shrink-0 border-b-2 border-black bg-white">
                <!-- Title / Breadcrumbs -->
                <div class="flex items-center gap-4">
                    <!-- Hamburger (Mobile Only) -->
                    <button @click="sidebarOpen = !sidebarOpen"
                        class="md:hidden w-8 h-8 flex items-center justify-center border-2 border-black bg-white active:bg-black active:text-white transition shadow-hard-sm">
                        <i class="ph-bold" :class="sidebarOpen ? 'ph-x' : 'ph-list'"></i>
                    </button>

                    <div class="flex flex-col justify-center">
                        <h1 class="text-xl md:text-2xl font-black text-black uppercase tracking-tighter">{% block
                            page_title %}Command
                            Center{% endblock %}</h1>
                    </div>
                </div>

                <!-- Right Actions -->
                <div class="flex items-center gap-4">
                    <!-- Brutalist Search -->
                    <div class="relative group">
                        <input type="text" class="nb-input h-10 w-64" placeholder="SEARCH DATABASE...">
                    </div>

                    <!-- Action Icons -->
                    <button id="notification-bell-btn"
                        class="w-10 h-10 border-2 border-black flex items-center justify-center bg-white hover:bg-acid-green transition-colors shadow-hard-sm active:translate-x-[2px] active:translate-y-[2px] active:shadow-none relative">
                        <i class="ph-bold ph-bell"></i>
                        <span id="notification-badge"
                            class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 border border-black text-white text-[10px] font-bold flex items-center justify-center rounded-full hidden">0</span>
                    </button>
                    <button
                        class="w-10 h-10 border-2 border-black flex items-center justify-center bg-white hover:bg-yellow-400 transition-colors shadow-hard-sm active:translate-x-[2px] active:translate-y-[2px] active:shadow-none">
                        <i class="ph-bold ph-gear"></i>
                    </button>
                </div>
            </header>

            <!-- Page Content Scroll Area -->
            {% block main_container %}
            <div class="flex-1 overflow-y-auto px-8 pb-8 custom-scrollbar">
                {% block content %}{% endblock %}
            </div>
            {% endblock %}

            {% block scripts %}{% endblock %}
        </main>

    </div>

    <!-- Scripts Block Moved Inside Main for Re-Execution -->

    <script src="/ui/js/notifications.js"></script>

    <!-- Penguin UI Toaster -->
    {% include "components/toast.html" %}

    <!-- Cat Companion Widget -->
    {% from "components/cat_widget.html" import cat_widget %}
    {{ cat_widget() }}

    <!-- System Internals Overlay -->
    {% include "components/connection_doctor.html" %}

</body>

</html>