{% macro audio_player(src=None, title="Audio Track", is_voice=False) %}
<!-- 
  Neopunk Ghettoblaster Player
  Style: Project Concrete v2.0
  Dependencies: Alpine.js
-->
{% set label = "VOICE NOTE" if is_voice else "AUDIO TRACK" %}
{% set sub_label = "REC" if is_voice else "HI-FI" %}
{% set accent = "text-rose-400" if is_voice else "text-cyan-400" %}
{% set accent_bg = "bg-rose-500" if is_voice else "bg-cyan-500" %}
{% set accent_shadow = "shadow-[0_0_10px_rgba(251,113,133,0.8)]" if is_voice else
"shadow-[0_0_10px_rgba(34,211,238,0.8)]" %}
{% set safe_src = src if src else '' %}

<div x-data="{ 
        playing: false, 
        audio: null, 
        progress: 0, 
        duration: 0,
        volume: 0.8,
        init() {
            this.audio = this.$refs.audioEl;
            if(this.audio) {
                this.audio.volume = this.volume;
                this.audio.addEventListener('loadedmetadata', () => {
                    this.duration = this.audio.duration;
                });
                this.audio.addEventListener('timeupdate', () => {
                    this.progress = (this.audio.currentTime / this.duration) * 100;
                });
                this.audio.addEventListener('ended', () => {
                    this.playing = false;
                    this.progress = 0;
                });
            }
        },
        toggle() {
            if (this.playing) this.pause();
            else this.play();
        },
        play() {
            if(this.audio) {
                this.audio.play();
                this.playing = true;
            }
        },
        pause() {
            if(this.audio) {
                this.audio.pause();
                this.playing = false;
            }
        },
        seek(e) {
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const per = x / rect.width;
            if(this.duration && this.audio) this.audio.currentTime = per * this.duration;
        }
    }"
    class="ghettoblaster-shell relative w-full bg-slate-900 border-2 border-slate-700 rounded-sm shadow-xl overflow-hidden font-mono group select-none hover:shadow-glow-md transition-shadow duration-300 transform hover:scale-[1.01]">

    <audio x-ref="audioEl" src="{{ safe_src }}" preload="metadata"></audio>

    <!-- Top Screw Header -->
    <div class="h-6 bg-slate-800 border-b border-slate-700 flex items-center justify-between px-2">
        <div class="flex gap-1">
            <div class="w-1.5 h-1.5 rounded-full bg-slate-600 shadow-inner"></div>
            <div class="w-1.5 h-1.5 rounded-full bg-slate-600 shadow-inner"></div>
        </div>
        <div class="text-[10px] text-slate-500 tracking-widest uppercase font-bold text-shadow-sm">Sonyk-9000</div>
        <div class="flex gap-1">
            <div class="w-1.5 h-1.5 rounded-full bg-slate-600 shadow-inner"></div>
            <div class="w-1.5 h-1.5 rounded-full bg-slate-600 shadow-inner"></div>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="p-4 flex flex-col gap-4 relative bg-gradient-to-b from-slate-900 to-slate-950">

        <!-- LCD Display -->
        <div
            class="lcd-screen bg-[#1a2d28] border-2 border-slate-600 h-20 rounded-sm relative overflow-hidden flex flex-col justify-center px-4 shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]">
            <!-- Scanlines -->
            <div
                class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-10 pointer-events-none bg-[length:100%_2px,3px_100%] opacity-20">
            </div>

            <div class="relative z-20 flex flex-col gap-1">
                <div class="flex justify-between items-end border-b border-cyan-900/30 pb-1 mb-1">
                    <span class="{{ accent }} text-[10px] tracking-wider animate-pulse font-bold"
                        x-show="playing">PLAYING >></span>
                    <span class="text-slate-600 text-[10px] tracking-wider font-bold" x-show="!playing">STANDBY</span>
                    <span class="{{ accent }} font-bold text-xs font-mono"
                        x-text="new Date(progress * duration * 10 || 0).toISOString().substr(14, 5)">00:00</span>
                </div>
                <div class="text-cyan-300 font-bold text-sm truncate uppercase tracking-widest text-shadow-glow">{{
                    title }}</div>
                <div class="text-[9px] text-slate-500 uppercase">{{ label }}</div>
            </div>

            <!-- Fake digital waveform -->
            <div class="absolute bottom-1 right-2 w-24 h-6 flex gap-0.5 items-end opacity-60">
                <template x-for="i in 16">
                    <div class="flex-1 {{ accent_bg }} shadow-[0_0_5px_rgba(34,211,238,0.5)] transition-all duration-100"
                        :style="'height: ' + (playing ? Math.random() * 100 : 10) + '%; opacity: ' + (playing ? 1 : 0.3)">
                    </div>
                </template>
            </div>
        </div>

        <!-- Controls Row -->
        <div class="flex items-center gap-4">
            <!-- Play Button -->
            <button @click="toggle()"
                class="w-14 h-14 bg-slate-800 rounded-full border-4 border-slate-950 active:border-slate-800 active:scale-95 transition-all {{ accent }} flex items-center justify-center hover:bg-slate-700 hover:shadow-[0_0_20px_rgba(34,211,238,0.2)] group/btn relative overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent rounded-full pointer-events-none">
                </div>
                <i class="ph-fill text-2xl drop-shadow-md" :class="playing ? 'ph-pause' : 'ph-play'"></i>
            </button>

            <!-- Scrubber -->
            <div class="flex-1 h-14 bg-slate-950 rounded border-2 border-slate-800 relative cursor-crosshair group/bar p-1 shadow-inner"
                @click="seek($event)">
                <!-- Track Line -->
                <div
                    class="absolute top-1/2 left-3 right-3 h-1.5 bg-slate-800 -translate-y-1/2 rounded-full overflow-hidden pointer-events-none border border-slate-900">
                    <div class="h-full {{ accent_bg }} {{ accent_shadow }} transition-all duration-100 ease-linear"
                        :style="'width: ' + progress + '%'"></div>
                </div>

                <!-- Thumb -->
                <div class="absolute top-1/2 w-3 h-8 bg-slate-300 border border-black -translate-y-1/2 -ml-1.5 transition-all duration-100 ease-linear pointer-events-none shadow-lg rounded-[1px] flex flex-col justify-center gap-[2px] items-center z-10"
                    :style="'left: calc(12px + (100% - 24px) * ' + (progress/100) + ')'">
                    <div class="w-2 h-[1px] bg-black/30"></div>
                    <div class="w-2 h-[1px] bg-black/30"></div>
                    <div class="w-2 h-[1px] bg-black/30"></div>
                </div>
            </div>

            <!-- Knob Decor -->
            <div
                class="w-12 h-12 bg-slate-800 rounded-full border-b-4 border-slate-950 flex items-center justify-center relative transform rotate-45 shadow-xl">
                <div class="w-1 h-4 bg-slate-950 absolute top-1.5 rounded-full shadow-[0_1px_0_rgba(255,255,255,0.1)]">
                </div>
                <div
                    class="absolute inset-0 rounded-full bg-gradient-to-br from-white/5 to-transparent pointer-events-none">
                </div>
            </div>
        </div>
    </div>

    <!-- Stickers / Badges -->
    <div
        class="absolute top-3 right-3 rotate-12 bg-yellow-400 text-black text-[9px] font-black px-1.5 py-0.5 border border-black shadow-sm uppercase z-10 opacity-90">
        {{ sub_label }}</div>
</div>
{% endmacro %}