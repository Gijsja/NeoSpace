<!-- 
  Toast Component (Notification System)
  Style: Neubrutalist (Strict)
  Usage: 
    1. Alpine: $store.toasts.add('Title', 'Message', 'success')
    2. JS: window.dispatchEvent(new CustomEvent('notify', { detail: { message: '...' } }))
-->
<script>
    document.addEventListener('alpine:init', () => {
        Alpine.store('toasts', {
            items: [],
            add(title, message, type = 'info', avatar = null) {
                const id = Date.now();
                this.items.push({ id, title, message, type, avatar });
                setTimeout(() => this.remove(id), 5000);
            },
            remove(id) {
                this.items = this.items.filter(t => t.id !== id);
            }
        });
    });

    // Compatibility adapter for existing event-based calls
    window.addEventListener('toast', (e) => {
        const { title, message, type, avatar } = e.detail;
        if (window.Alpine) {
            Alpine.store('toasts').add(title || 'Notification', message, type, avatar);
        }
    });

    window.addEventListener('notify', (e) => {
        if (window.Alpine) {
            Alpine.store('toasts').add('System', e.detail.message, e.detail.type || 'info');
        }
    });
</script>

<div class="fixed top-20 right-6 z-[100] flex flex-col gap-4 pointer-events-none" x-data>
    <template x-for="toast in $store.toasts.items" :key="toast.id">
        <div class="pointer-events-auto w-[350px] bg-white border-4 border-black shadow-hard p-4 flex gap-4 transition-all"
            x-transition:enter="transition ease-out duration-300 transform"
            x-transition:enter-start="translate-x-full opacity-0" x-transition:enter-end="translate-x-0 opacity-100"
            x-transition:leave="transition ease-in duration-200 transform"
            x-transition:leave-start="translate-x-0 opacity-100" x-transition:leave-end="translate-x-full opacity-0">

            <!-- Icon/Avatar -->
            <div class="shrink-0 pt-1">
                <template x-if="toast.avatar">
                    <div class="w-12 h-12 border-2 border-black bg-gray-100">
                        <img :src="toast.avatar" class="w-full h-full object-cover">
                    </div>
                </template>

                <!-- Status Icons -->
                <template x-if="!toast.avatar">
                    <div class="w-10 h-10 border-2 border-black flex items-center justify-center shadow-hard-sm" :class="{
                             'bg-neon-green': toast.type === 'success',
                             'bg-hot-pink text-white': toast.type === 'error',
                             'bg-electric-yellow': toast.type === 'warning',
                             'bg-cyber-blue': toast.type === 'info'
                         }">
                        <i class="ph-bold text-lg" :class="{
                               'ph-check': toast.type === 'success',
                               'ph-warning': toast.type === 'error' || toast.type === 'warning',
                               'ph-info': toast.type === 'info'
                           }"></i>
                    </div>
                </template>
            </div>

            <div class="flex-1 min-w-0">
                <h4 class="font-black text-sm uppercase tracking-wider truncate mb-1" x-text="toast.title"></h4>
                <p class="text-xs font-mono font-bold leading-snug break-words" x-text="toast.message"></p>
            </div>

            <button @click="$store.toasts.remove(toast.id)"
                class="shrink-0 w-6 h-6 flex items-center justify-center border-2 border-transparent hover:border-black hover:bg-red-100 transition-colors self-start -mr-2 -mt-2">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>
    </template>
</div>